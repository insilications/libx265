mkdir -p 8bit 10bit 12bit

cd 12bit
cmake ../../source -G "Unix Makefiles" -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON -DCMAKE_INSTALL_PREFIX=/usr -DLIB_SUFFIX=64 -DCMAKE_AR=/usr/bin/gcc-ar -DCMAKE_NM=/usr/bin/gcc-nm -DCMAKE_RANLIB=/usr/bin/gcc-ranlib -DLIB_INSTALL_DIR=lib64 -DNATIVE_BUILD:BOOL=ON -DSTATIC_LINK_CRT:BOOL=ON -DBUILD_STATIC_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_DOCS:BOOL=OFF -DENABLE_ASSEMBLY:BOOL=ON -DENABLE_NASM:BOOL=ON -DENABLE_PIC:BOOL=ON -DENABLE_LIBNUMA:BOOL=OFF -DENABLE_LIBNUMA:BOOL=OFF -DEXPORT_C_API:BOOL=OFF -DENABLE_CLI:BOOL=OFF -DMAIN12:BOOL=ON -DHIGH_BIT_DEPTH:BOOL=ON
make -j16 V=1 VERBOSE=1

cd ../10bit
cmake ../../source -G "Unix Makefiles" -DCMAKE_VERBOSE_MAKEFILE:BOOL:BOOL=ON -DCMAKE_INSTALL_PREFIX=/usr -DLIB_SUFFIX=64 -DCMAKE_AR=/usr/bin/gcc-ar -DCMAKE_NM=/usr/bin/gcc-nm -DCMAKE_RANLIB=/usr/bin/gcc-ranlib -DLIB_INSTALL_DIR=lib64 -DNATIVE_BUILD:BOOL=ON -DSTATIC_LINK_CRT:BOOL=ON -DBUILD_STATIC_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_DOCS:BOOL=OFF -DENABLE_ASSEMBLY:BOOL=ON -DENABLE_NASM:BOOL=ON -DENABLE_PIC:BOOL=ON -DENABLE_LIBNUMA:BOOL=OFF -DEXPORT_C_API:BOOL=OFF -DENABLE_CLI:BOOL=OFF -DHIGH_BIT_DEPTH:BOOL=ON
make -j16 V=1 VERBOSE=1

cd ../8bit
cp -f ../10bit/libx265.a libx265_main10.a
cp -f ../12bit/libx265.a libx265_main12.a
cmake ../../source -G "Unix Makefiles" -DCMAKE_VERBOSE_MAKEFILE:BOOL:BOOL=ON -DCMAKE_INSTALL_PREFIX=/usr -DLIB_SUFFIX=64 -DCMAKE_AR=/usr/bin/gcc-ar -DCMAKE_NM=/usr/bin/gcc-nm -DCMAKE_RANLIB=/usr/bin/gcc-ranlib -DLIB_INSTALL_DIR=lib64 -DNATIVE_BUILD:BOOL=ON -DSTATIC_LINK_CRT:BOOL=ON -DBUILD_STATIC_LIBS:BOOL=ON -DENABLE_SHARED:BOOL=ON -DCMAKE_BUILD_TYPE=Release -DENABLE_DOCS:BOOL=OFF -DENABLE_ASSEMBLY:BOOL=ON -DENABLE_NASM:BOOL=ON -DENABLE_PIC:BOOL=ON -DENABLE_LIBNUMA:BOOL=OFF -DHIGH_BIT_DEPTH:BOOL=ON -DENABLE_HDR10_PLUS:BOOL=ON -DENABLE_TESTS:BOOL=ON -DENABLE_CLI:BOOL=ON -DEXTRA_LIB="x265_main10.a;x265_main12.a" -DEXTRA_LINK_FLAGS="-L. -L/usr/lib64" -DLINKED_10BIT:BOOL=ON -DLINKED_12BIT:BOOL=ON
make -j16 V=1 VERBOSE=1

# rename the 8bit library, then combine all three into libx265.a
mv libx265.a libx265_main.a
# On Linux, we use GNU ar to combine the static libraries together
gcc-ar -M <<EOF
CREATE libx265.a
ADDLIB libx265_main.a
ADDLIB libx265_main10.a
ADDLIB libx265_main12.a
SAVE
END
EOF 
#
